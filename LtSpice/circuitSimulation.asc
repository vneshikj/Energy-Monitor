Version 4
SHEET 1 4308 2980
WIRE 976 384 816 384
WIRE 896 480 896 464
WIRE 816 496 816 384
WIRE 864 496 816 496
WIRE -576 512 -608 512
WIRE -496 512 -576 512
WIRE -416 512 -432 512
WIRE -304 512 -336 512
WIRE -272 512 -304 512
WIRE -192 512 -272 512
WIRE 144 512 144 464
WIRE 144 512 64 512
WIRE 416 512 144 512
WIRE 976 512 976 384
WIRE 976 512 928 512
WIRE 1040 512 976 512
WIRE 800 528 752 528
WIRE 864 528 800 528
WIRE 416 624 416 512
WIRE 800 640 800 528
WIRE -272 672 -272 512
WIRE 144 672 144 512
WIRE -272 832 -272 736
WIRE -64 832 -64 608
WIRE -64 832 -272 832
WIRE 144 832 144 736
WIRE 144 832 -64 832
WIRE 416 832 416 704
WIRE 416 832 144 832
WIRE 800 848 800 720
WIRE -240 1120 -576 1120
WIRE -32 1120 -240 1120
WIRE 864 1136 816 1136
WIRE 928 1136 864 1136
WIRE 864 1168 864 1136
WIRE -240 1184 -240 1120
WIRE -32 1184 -32 1120
WIRE 368 1184 352 1184
WIRE 480 1184 448 1184
WIRE 864 1264 864 1232
WIRE -576 1280 -576 1120
WIRE 240 1280 208 1280
WIRE 352 1280 352 1184
WIRE 352 1280 320 1280
WIRE 352 1296 352 1280
WIRE 384 1296 352 1296
WIRE 480 1312 480 1184
WIRE 480 1312 448 1312
WIRE 496 1312 480 1312
WIRE -576 1328 -576 1280
WIRE 384 1328 352 1328
WIRE -240 1344 -240 1264
WIRE -32 1344 -32 1264
WIRE 240 1344 224 1344
WIRE 352 1344 352 1328
WIRE 352 1344 320 1344
WIRE 352 1360 352 1344
WIRE -32 1376 -32 1344
WIRE -240 1456 -240 1424
WIRE 352 1456 352 1440
WIRE -240 1472 -240 1456
WIRE -576 1600 -576 1408
WIRE -240 1600 -240 1552
WIRE -240 1600 -576 1600
WIRE -32 1600 -32 1456
WIRE -32 1600 -240 1600
WIRE 880 1664 832 1664
WIRE 944 1664 880 1664
WIRE 368 1680 352 1680
WIRE 480 1680 448 1680
WIRE 880 1712 880 1664
WIRE 240 1776 208 1776
WIRE 352 1776 352 1680
WIRE 352 1776 320 1776
WIRE 352 1792 352 1776
WIRE 384 1792 352 1792
WIRE 480 1808 480 1680
WIRE 480 1808 448 1808
WIRE 496 1808 480 1808
WIRE 384 1824 352 1824
WIRE 240 1840 208 1840
WIRE 352 1840 352 1824
WIRE 352 1840 320 1840
WIRE 352 1856 352 1840
WIRE 352 1952 352 1936
WIRE 384 2272 384 2240
WIRE 240 2288 224 2288
WIRE 352 2288 320 2288
WIRE 512 2304 416 2304
WIRE 560 2304 512 2304
WIRE 352 2320 320 2320
FLAG 416 1840 0
FLAG 416 1776 5V
FLAG 208 1776 0
FLAG 352 1952 2V1
FLAG 416 1344 0
FLAG 416 1280 5V
FLAG 208 1280 0
FLAG 352 1456 2V1
FLAG -576 512 Vsupply
FLAG 864 1264 0
FLAG -304 512 Vin
FLAG -240 1600 0
FLAG 880 1776 0
FLAG -64 832 0
FLAG -32 1344 Vvs
FLAG 144 464 5V
FLAG 1040 512 2V1
FLAG 384 2240 5V
FLAG 384 2336 0
FLAG 224 2288 Vvs
FLAG 896 544 0
FLAG 896 464 5V
FLAG 512 2384 0
FLAG 320 2400 0
FLAG 560 2304 Vzvc
FLAG -240 1456 Vis
FLAG 224 1344 Vis
FLAG 496 1312 ViOut
FLAG 736 1136 ViOut
FLAG 496 1808 VvOut
FLAG 208 1840 Vvs
FLAG 752 1664 VvOut
FLAG 800 848 0
FLAG 672 528 5V
FLAG -576 1280 Vsupply
SYMBOL PowerProducts/LT1085-5 -64 512 R0
SYMATTR InstName Reg
SYMBOL res 400 608 R0
SYMATTR InstName RL
SYMATTR Value 100
SYMBOL res -320 496 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rin
SYMATTR Value 33
SYMBOL diode -496 528 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL cap -288 672 R0
SYMATTR InstName Cin
SYMATTR Value 47µ
SYMATTR SpiceLine Rser=0.001
SYMBOL cap 128 672 R0
SYMATTR InstName Cout
SYMATTR Value 10µ
SYMATTR SpiceLine Rser=0.001
SYMBOL Opamps/opamp2 416 1744 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U21
SYMATTR Value LM324
SYMBOL res 336 1824 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName R1a3
SYMATTR Value 95.4k
SYMBOL res 336 1760 R90
WINDOW 0 -32 53 VBottom 2
WINDOW 3 -32 55 VTop 2
SYMATTR InstName R1b3
SYMATTR Value 100k
SYMBOL res 464 1664 R90
WINDOW 0 -30 61 VBottom 2
WINDOW 3 -30 60 VTop 2
SYMATTR InstName R2b3
SYMATTR Value 100k
SYMBOL res 368 1952 R180
WINDOW 0 -62 57 Left 2
WINDOW 3 -44 34 Left 2
SYMATTR InstName R2a3
SYMATTR Value 100k
SYMBOL Opamps/opamp2 416 1248 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U1
SYMATTR Value LM324
SYMBOL res 336 1328 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName R1a4
SYMATTR Value 6.8k
SYMBOL res 336 1264 R90
WINDOW 0 -32 53 VBottom 2
WINDOW 3 -32 55 VTop 2
SYMATTR InstName R1b4
SYMATTR Value 6.8k
SYMBOL res 464 1168 R90
WINDOW 0 -30 61 VBottom 2
WINDOW 3 -31 62 VTop 2
SYMATTR InstName R2b4
SYMATTR Value 12k
SYMBOL res 368 1456 R180
WINDOW 0 -62 57 Left 2
WINDOW 3 -44 34 Left 2
SYMATTR InstName R2a4
SYMATTR Value 12k
SYMBOL res 832 1120 R90
WINDOW 0 62 55 VBottom 2
WINDOW 3 61 57 VTop 2
SYMATTR InstName Rf
SYMATTR Value 4.8k
SYMBOL cap 880 1232 R180
WINDOW 0 -42 39 Left 2
WINDOW 3 -85 -3 Left 2
SYMATTR InstName Cf
SYMATTR Value 3.9nF
SYMBOL voltage -576 1312 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vsupply
SYMATTR Value SINE(0 21.78 500)
SYMBOL ind -256 1168 R0
SYMATTR InstName Lload
SYMATTR Value 4mH
SYMBOL res -256 1328 R0
SYMATTR InstName Rload
SYMATTR Value 0
SYMBOL res -48 1168 R0
SYMATTR InstName Ra
SYMATTR Value 100k
SYMBOL res -256 1456 R0
SYMATTR InstName Rs
SYMATTR Value 0.56
SYMBOL res -48 1360 R0
SYMATTR InstName Rb
SYMATTR Value 4.8k
SYMBOL res 848 1648 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 4.8k
SYMBOL cap 864 1712 R0
WINDOW 3 46 50 Left 2
SYMATTR Value 3.9nF
SYMATTR InstName C1
SYMBOL Opamps/opamp2 896 448 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U3
SYMATTR Value LM324
SYMBOL res 768 512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 53.86k
SYMBOL res 784 624 R0
SYMATTR InstName R6
SYMATTR Value 39k
SYMBOL Opamps/opamp2 384 2240 R0
WINDOW 0 23 81 Left 2
WINDOW 3 24 105 Left 2
SYMATTR InstName U5
SYMATTR Value LM324
SYMBOL res 336 2272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 100k
SYMBOL res 496 2288 R0
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL res 304 2304 R0
SYMATTR InstName R3
SYMATTR Value 100k
TEXT -1320 192 Left 2 !.lib LM324.lib
TEXT -1320 224 Left 2 !.tran 0 1 0
TEXT -168 336 Left 2 ;5V AC-DC Regulator
TEXT 280 1568 Left 2 ;Voltage Sensor
TEXT 784 1568 Left 2 ;Filter
TEXT 776 1072 Left 2 ;Filter
TEXT 1104 1176 Left 2 ;Terminals to go into ATMega328P ADC converter
TEXT -408 1240 Left 2 ;AC Load
TEXT -576 1672 Left 2 ;Use 33 Ohm RLoad, as following E12 resistor series. \nClosest approximation and minimal power draw.
TEXT 168 2032 Left 2 ;For R1a3, Use 82k, 12k and \nthree 150Ohm in series to make 94.5k
TEXT 216 2152 Left 2 ;Zero Voltage Crossing Detector
TEXT 672 1856 Left 2 ;R1 (4.8k), use 4.7k + 100 in series
TEXT -1312 152 Left 2 ;Simulation Commands
TEXT 272 1080 Left 2 ;Current Sensor
TEXT 664 2312 Left 2 ;Output into ATmega
TEXT -1320 248 Left 2 ;.ac dec 30 1 1Meg
TEXT 664 1328 Left 2 ;Rf use 4.7k and 100 Ohm in series
TEXT 832 744 Left 2 ;Voltage Divider and \nFollower Provides 2.1V \nfor opamp DC offset
TEXT 640 936 Left 2 ;For R5, use 47k and 6.8k in series\n(and 68Ohms for more accuracy)
TEXT 664 1368 Left 2 ;Cutoff frequency is 10kHz
TEXT 672 1912 Left 2 ;Cutoff frequency is 10kHz
TEXT 760 288 Left 2 ;2.1V DC Offset
RECTANGLE Normal -1360 108 -924 312 2
RECTANGLE Normal -292 1424 -112 1164 2
RECTANGLE Normal 168 1100 580 1528 2
RECTANGLE Normal 168 1596 592 2008 2
RECTANGLE Normal 1136 880 624 352 2
RECTANGLE Normal 528 880 -656 384 2
RECTANGLE Normal 80 1648 -656 1088 2
RECTANGLE Normal 640 2448 160 2192 2
RECTANGLE Normal 992 1296 640 1104 2
RECTANGLE Normal 1008 1824 656 1600 2
